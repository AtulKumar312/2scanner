<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Scanner</title>
    <style>
        /* Adjust styling as needed */
        #reader {
            max-width: 100%;
        }
        #searchArea {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>QR Scanner</h1>

    <div id="reader"></div>

    <div id="searchArea" style="display: none;">
        <h2>Search Area</h2>
        <input type="text" id="searchInput" placeholder="Enter value to search" disabled>
        <button id="searchButton" disabled>Search</button>
    </div>

    <div id="result"></div>
    <div id="sessionMessage" style="display: none;">Session Started</div>

    <script src="html5-qrcode.min.js"></script>
    <script>
        const qrCodeScanner = new Html5Qrcode("reader");
        const startSessionQRCode = "http://1234"; // Change this to the QR code to start a session
        let sessionStarted = false;
        let scannerEnabled = true; // Added variable to track scanner state
        const searchInput = document.getElementById("searchInput");
        const searchButton = document.getElementById("searchButton");
        const searchArea = document.getElementById("searchArea");

        qrCodeScanner.start(
            { facingMode: "environment" },
            { fps: 10, qrbox: 250 },
            handleQRCodeScanned,
            handleQRCodeError
        );

        function handleQRCodeScanned(qrCodeMessage) {
            if (!sessionStarted && qrCodeMessage === startSessionQRCode) {
                console.log("Start Session QR Code detected:", qrCodeMessage);
                startSession();
            } else if (sessionStarted && scannerEnabled) {
                // Attempt to find a new QR code
                attemptToFindNewQRCode(qrCodeMessage);
            }
        }

        function handleQRCodeError(errorMessage) {
            // Failed to scan QR code
            console.error(errorMessage);
        }

        const resultContainer = document.getElementById("result");
        const sessionMessage = document.getElementById("sessionMessage");

        function displayResult(message) {
            const resultElement = document.createElement("p");
            resultElement.textContent = "Scanned QR Code: " + message;
            resultContainer.appendChild(resultElement);
        }

        function startSession() {
            sessionStarted = true;
            sessionMessage.style.display = "block";
            searchInput.removeAttribute("disabled"); // Enable search input
            searchButton.removeAttribute("disabled"); // Enable search button
            searchArea.style.display = "block"; // Display the search area
        }

        function attemptToFindNewQRCode(message) {
            // Here you can implement logic to detect a new QR code
            // For example, you might check if the scanned code is not the same as the startSessionQRCode
            // If a new QR code is found, you can display a message or perform further actions.
            if (message !== startSessionQRCode) {
                console.log("New QR Code found:", message);
                displayResult("New QR Code Found: " + message);
            }
        }

        function performSearch() {
            const searchTerm = searchInput.value;
            if (scannerEnabled && searchTerm === startSessionQRCode) {
                console.log("Searched QR Code found:", searchTerm);
                displayResult("Searched QR Code Found: " + searchTerm);
                scannerEnabled = false; // Disable scanner after finding the desired QR code
            }
        }

        searchButton.addEventListener("click", performSearch);

        // ... Rest of your code ...
    </script>
</body>
</html>
