<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Scanner</title>
</head>
<body>
    <h1>QR Scanner</h1>
    <div id="reader" style="max-width: 100%;"></div>
    <button id="toggleScanner">Toggle Scanner</button>
    
    <div id="searchArea" style="display: none;">
        <h2>Search Area</h2>
        <input type="text" id="searchInput" placeholder="Enter value to search">
        <button id="searchButton">Search</button>
    </div>
    
    <div id="result"></div>
    <div id="sessionMessage" style="display: none;">Session Started</div>

    <script src="html5-qrcode.min.js"></script>
    <script>
        const qrCodeScanner = new Html5Qrcode("reader");
        const startSessionQRCode = "http://1234"; // Change this to the QR code to start a session
        let sessionStarted = false;
        let scannerEnabled = true;

        const toggleScannerButton = document.getElementById("toggleScanner");
        toggleScannerButton.addEventListener("click", toggleScanner);

        const searchArea = document.getElementById("searchArea");
        const searchInput = document.getElementById("searchInput");
        const searchButton = document.getElementById("searchButton");
        searchButton.addEventListener("click", performSearch);

        function toggleScanner() {
            if (!sessionStarted) {
                if (scannerEnabled) {
                    qrCodeScanner.stop();
                    scannerEnabled = false;
                } else {
                    qrCodeScanner.start(
                        { facingMode: "environment" },
                        { fps: 10, qrbox: 250 },
                        handleQRCodeScanned,
                        handleQRCodeError
                    );
                    scannerEnabled = true;
                }
            }
        }

        function handleQRCodeScanned(qrCodeMessage) {
            if (!sessionStarted && qrCodeMessage === startSessionQRCode) {
                console.log("Start Session QR Code detected:", qrCodeMessage);
                startSession();
            } else if (sessionStarted && scannerEnabled) {
                // Attempt to find a new QR code
                attemptToFindNewQRCode(qrCodeMessage);
            }
        }

        function handleQRCodeError(errorMessage) {
            // Failed to scan QR code
            console.error(errorMessage);
        }

        const resultContainer = document.getElementById("result");
        const sessionMessage = document.getElementById("sessionMessage");
        const searchInputField = document.getElementById("searchInput");

        function displayResult(message) {
            const resultElement = document.createElement("p");
            resultElement.textContent = "Scanned QR Code: " + message;
            resultContainer.appendChild(resultElement);
        }

        function startSession() {
            sessionStarted = true;
            sessionMessage.style.display = "block";
            searchArea.style.display = "block"; // Display the search area
            qrCodeScanner.stop(); // Turn off the camera after session has started
        }

        function attemptToFindNewQRCode(message) {
            // Here you can implement logic to detect a new QR code
            // For example, you might check if the scanned code is not the same as the startSessionQRCode
            // If a new QR code is found, you can display a message or perform further actions.
            if (message !== startSessionQRCode) {
                console.log("New QR Code found:", message);
                displayResult("New QR Code Found: " + message);
            }
        }

        function performSearch() {
            const searchTerm = searchInput.value;
            if (searchTerm) {
                qrCodeScanner.start(
                    { facingMode: "environment" },
                    { fps: 10, qrbox: 250 },
                    handleQRCodeScannedDuringSearch,
                    handleQRCodeError
                );
            }
        }

        function handleQRCodeScannedDuringSearch(qrCodeMessage) {
            if (qrCodeMessage === searchInput.value) {
                console.log("Searched QR Code found:", qrCodeMessage);
                displayResult("Searched QR Code Found: " + qrCodeMessage);
            }
        }

        // ... Rest of your code ...
    </script>
</body>
</html>
